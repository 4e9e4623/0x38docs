# exo2SubFile

### バージョン:現在公開準備中です
 
## 概要
Aviutlの拡張編集プラグインなどから生成したexoファイルから
指定されたレイヤーにあるテキストを含むオブジェクトから文字列と表示時間のみを抽出し
字幕ファイルとして出力するプログラムです  
字幕ファイルはYouTubeや各種メディアプレーヤーで使用できます

## 動作環境
* OS:Windows 10(20H2) 64Bit版（日本語版）
    * Windows 8.1以前での動作は不明です
    * Windows 10であっても旧バージョンでの動作は不明です
    * 32bit(x86)/ARM/ARM64版Windowsでは動作しません
    * 日本語版以外（メモ帳などのANSIがCP932として扱われない）の環境での動作は不明です
* 本プログラムが保存されているドライブが書き込み可能で、十分な空き容量があること
    * 使用するexoファイルの2倍程度は空き容量を確保してください
* 次のプログラムがインストールされていること
    * [Visual Studio 2015、2017、および 2019 用Microsoft Visual C++ 再頒布可能パッケージ](https://support.microsoft.com/ja-jp/topic/%E6%9C%80%E6%96%B0%E3%81%AE%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%81%95%E3%82%8C%E3%82%8B-visual-c-%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89-2647da03-1eea-4433-9aff-95f26a218cc0)
        * プログラム実行時に**コンピューターにMSVCP140.dllがないため、プログラムを開始できません**といったエラーが表示された場合のみ、上記のリンクから「Visual Studio 2015、2017 および 2019」内の「vc_redist.x64.exe」をダウンロード＆インストールして下さい


## 使用の条件について
* 本ソフトウェアはフリーソフトウェアです
* 使用はソフトウェア使用者の自己責任となり、作者はいかなる責任も負いかねます
* サポートは行いません
    * でも作者のTwitterへリプライを投げつけると、返信するかも？
* 不具合があった場合は、下記のリンクからご報告をお願い致します
    * ただし対応するとは言っていない
* 本プログラムのネットワーク上での再頒布は禁止です
* 使用時の報告や動画内でのツール名記載などはしないで問題ありませんが、下記リンクから報告（任意）を頂けると励みになります
    * YouTubeの場合：毎回だと面倒だと思うので、チャンネル単位で1度で構いません→
    * niconicoの場合：字幕形式以外で出力を行ったデータを使用した場合は→
    * その他動画サイト：こちらの場合もチャンネル単位で1度で構いません→


## 想定しているファイル
以下の要件の内1つでも満たしていない.exoファイルを本プログラムで処理する場合、出力ファイルを各種ソフトウェアで表示する際に問題が発生したり、想定した内容にならなかったりする場合があります  
※本ソフトウェアでの処理自体は大抵の場合問題ありませんが、強制終了する可能性もあります
* 抽出対象レイヤーが1つのみ、または各抽出対象レイヤーのテキストを含むオブジェクトの表示時間が重複していないこと
* 直前のテキストを含むオブジェクトと1フレーム以上の空きがあること
* 抽出対象レイヤーのテキストを含むオブジェクトのテキストが1つ当たり1023文字以内（.exoファイル内では16進数表記で4096文字の固定長で表したもの）であること
* 抽出対象レイヤーのテキストを含むオブジェクトの表示時間が.exoファイルの時間内に収まっていること
* 横書きのオブジェクトで縦書きになるように（またはその逆に）していないこと
* Shift_JIS（厳密にはCP932）とUTF-8のどちらでも表現可能な文字のみを使用していること
* いわゆる外字や合字（例：[たすけて](https://dic.nicovideo.jp/a/%E3%81%9F%CD%9C%CD%9C%CD%8F%CC%98%CC%A3%CD%94%CD%99%CD%8E%CD%8E%CC%98%CC%9C%CC%AB%CC%97%CD%8D%CD%9A%CD%93%CD%9C%CD%9C%CD%8F%CC%98%CC%A3%CD%94%CD%99%CD%8E%CD%8E%E3%81%99%CD%9C%CD%9C%CD%8F%CC%98%CC%A3%CD%94%CD%99%CD%8E%CD%8E%C6%A1%CC%9F%CC%A4%CC%96%CC%97%CD%96%CD%87%CC%8D%CD%8B%CC%80%CD%86%CC%93%CC%81%CD%9E%CD%A1%E3%81%91%CC%9C%CD%AA%CC%85%CC%8D%CC%85%CD%82%CD%8A%E3%81%A6)）が含まれていないこと
* 「ASCII制御文字」や「Unicode制御文字」を使用していないこと
* 「拡張編集プラグインの制御文字」の「スクリプト（```<?[スクリプト]?>```など）」を使用していないこと（PSD ToolKitの字幕準備オブジェクトを除く）
* 「拡張編集プラグインの制御文字」の「表示クリア（```<c>```または```<c*>```）」を使用していないこと
* 以下の方法で文字の表示位置調整を行っていないこと
    * 空白やタブなど
    * 「拡張編集プラグインの制御文字」の「座標の指定（```<p[X,Y[,Z]]>```）」
* ~~文字列の先頭に改行が存在しないこと~~＆~~文字列に改行文字が2回以上連続している部分が存在しないこと~~
    * srtやsvb形式で出力する場合はこれらは自動で修正を行います
    * 指定文字/文字列削除の後にその処理が必要な形式でのみ上記処理を行います

## 使用方法（簡易版）
1. **こんばーたー.bat**を起動します
    > 注：**こんばーたー.bat**ではなく**こんばーたー**が表示される場合は、エクスプローラーの「表示」内の「ファイル名拡張子」にチェックを入れてください
2. 処理対象のexoファイルを黒い画面の中にD&D、またはパスを入力します
    > 注：直接パスを入力する際、パスに半角空白が含まれる場合は半角のダブルクォーテーションでパスを囲って下さい
3. 抽出したいテキストが含まれるオブジェクトが含まれるレイヤー番号を半角数字で入力します  
レイヤー番号が複数ある場合は、半角空白で区切って複数入力して下さい
    > 注：抽出対象の各レイヤーでテキストが含まれるオブジェクトの表示時間が重複している場合、出力内容を表示する際に問題が起きたり、表示内容が想定していないものになったりする事があります（本プログラムでの出力自体には問題はありません）
4. 抽出結果が**output.srt**として**こんばーたー.bat**と同じフォルダに出力されます

## 使用方法（コマンドライン引数を直接指定する場合）
```
exo2subdata.exe <出力形式> <ファイルパス> <レイヤー番号>
```
* 出力形式  
SubRip（.srt）やSubViwer(.svb)形式での出力を推奨しますが、一応それ以外の形式でも出力可能です  
※出力ファイルの文字コードは特記がない限りUTF-8となります

    |引数の<br>指定文字|内容|詳細|YouTubeへの<br>アップロードの可否|
    |:-:|:-:|:-|:-:|
    |srt|SubRip形式|一般的な字幕形式です|可|
    |svb|SubViewer形式|一般的な字幕形式です<br>こちらはSubRip形式とは違い連番がありません|可|
    |csv|カンマ区切りのテキスト|開始時間,終了時間,テキスト内容<br>をダブルクォーテーションで囲ったものをカンマ区切りで出力します<br>元のテキストを含むオブジェクトにダブルクォーテーションやカンマがあると正常に読み込めない場合があります|不可|
    |tsv|タブ区切りのテキスト|上記csvのタブ区切り版です|不可|
    |txt|プレーンテキスト|テキストを含むオブジェクト毎に1行空白を挟んで出力します<br>時間は出力されません|(一応)可|

* ファイルパス  
.exoファイルのパスを指定します  
パスの中に空白が含まれる場合はパスを半角のダブルクォーテーションで囲って下さい

* レイヤー番号  
読み込んだexoファイルの中で字幕として出力したいテキストを含むオブジェクトが含まれるレイヤー番号を指定します  
半角空白で区切ることでレイヤー番号を複数指定することも可能ですが、出力内容を表示する際に問題が起きたり、<br>表示内容が想定していないものになったりする場合があります（出力結果を表示するプログラムによって異なります）

## YouTubeへの字幕ファイルのアップロード方法
準備中

## 連絡先とリンク
* Twitter
    * [@4e9e4623](https://twitter.com/4e9e4623)
    * [@PouchComp](https://twitter.com/PouchComp)  
* 問い合わせ等のフォーム（返信なし）
    * 準備中
* その他の公開物
    * [コチラ](https://4e9e4623.github.io/docs/)から

## 更新履歴
* Ver 1.00.0
    * 初版

## 開発環境とツール
* IDE
    * Visual Studio 2019 Community
* テキストエディタ
    * notepad.exe
    * Visual Studio Code
